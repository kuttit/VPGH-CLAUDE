generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Country {
  id                   String               @id @default(dbgenerated("uuid_generate_v4()")) @map("country_id") @db.Uuid
  countryCode          String               @unique @map("country_code") @db.VarChar(3)
  countryCodeAlpha2    String               @unique @map("country_code_alpha2") @db.VarChar(2)
  countryName          String               @map("country_name") @db.VarChar(100)
  numericCode          String?              @map("numeric_code") @db.VarChar(3)
  isActive             Boolean              @default(true) @map("is_active")
  region               String?              @db.VarChar(50)
  subRegion            String?              @map("sub_region") @db.VarChar(50)
  metadata             Json                 @default("{}")
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  paymentRailCountries PaymentRailCountry[]
  paymentRails         PaymentRail[]
  routingRulesFrom     RoutingRule[]        @relation("CountryFrom")
  routingRulesTo       RoutingRule[]        @relation("CountryTo")
  transactionParties   TransactionParty[]

  @@index([countryCode])
  @@index([countryCodeAlpha2])
  @@map("countries")
}

model Currency {
  id                            String                @id @default(dbgenerated("uuid_generate_v4()")) @map("currency_id") @db.Uuid
  currencyCode                  String                @unique @map("currency_code") @db.VarChar(3)
  currencyName                  String                @map("currency_name") @db.VarChar(100)
  numericCode                   String?               @map("numeric_code") @db.VarChar(3)
  minorUnits                    Int                   @default(2) @map("minor_units") @db.SmallInt
  symbol                        String?               @db.VarChar(10)
  isActive                      Boolean               @default(true) @map("is_active")
  metadata                      Json                  @default("{}")
  createdAt                     DateTime              @default(now()) @map("created_at")
  updatedAt                     DateTime              @updatedAt @map("updated_at")
  feeConfigurations             FeeConfiguration[]
  paymentRailCurrencies         PaymentRailCurrency[]
  paymentTransactionsInstructed PaymentTransaction[]  @relation("InstructedCurrency")
  paymentTransactionsSettlement PaymentTransaction[]  @relation("SettlementCurrency")
  routingRules                  RoutingRule[]

  @@index([currencyCode])
  @@map("currencies")
}

model PaymentRail {
  id                    String                @id @default(dbgenerated("uuid_generate_v4()")) @map("rail_id") @db.Uuid
  railCode              String                @unique @map("rail_code") @db.VarChar(50)
  railName              String                @map("rail_name") @db.VarChar(100)
  railDescription       String?               @map("rail_description")
  railType              String                @map("rail_type") @db.VarChar(50)
  operatorName          String?               @map("operator_name") @db.VarChar(100)
  operatorCountryId     String?               @map("operator_country_id") @db.Uuid
  isRealTime            Boolean               @default(false) @map("is_real_time")
  is24x7                Boolean               @default(false) @map("is_24x7")
  settlementType        String?               @map("settlement_type") @db.VarChar(50)
  maxAmount             Decimal?              @map("max_amount") @db.Decimal(18, 2)
  minAmount             Decimal               @default(0) @map("min_amount") @db.Decimal(18, 2)
  cutoffTime            DateTime?             @map("cutoff_time") @db.Time(6)
  timezone              String?               @db.VarChar(50)
  messageFormat         String?               @map("message_format") @db.VarChar(50)
  version               String?               @db.VarChar(20)
  isActive              Boolean               @default(true) @map("is_active")
  railConfig            Json                  @default("{}") @map("rail_config")
  apiConfig             Json                  @default("{}") @map("api_config")
  securityConfig        Json                  @default("{}") @map("security_config")
  metadata              Json                  @default("{}")
  createdAt             DateTime              @default(now()) @map("created_at")
  updatedAt             DateTime              @updatedAt @map("updated_at")
  createdBy             String?               @map("created_by") @db.VarChar(100)
  updatedBy             String?               @map("updated_by") @db.VarChar(100)
  feeConfigurations     FeeConfiguration[]
  paymentProducts       PaymentProduct[]
  paymentRailCountries  PaymentRailCountry[]
  paymentRailCurrencies PaymentRailCurrency[]
  operatorCountry       Country?              @relation(fields: [operatorCountryId], references: [id])
  paymentTransactions   PaymentTransaction[]
  routingRulesFallback  RoutingRule[]         @relation("FallbackRail")
  routingRulesTarget    RoutingRule[]         @relation("TargetRail")
  validationRules       ValidationRule[]
  workflowDefinitions   WorkflowDefinition[]

  @@index([railCode])
  @@index([railType])
  @@index([isActive])
  @@map("payment_rails")
}

model PaymentProduct {
  id                  String               @id @default(dbgenerated("uuid_generate_v4()")) @map("product_id") @db.Uuid
  railId              String               @map("rail_id") @db.Uuid
  productCode         String               @map("product_code") @db.VarChar(50)
  productName         String               @map("product_name") @db.VarChar(100)
  productDescription  String?              @map("product_description")
  productType         String?              @map("product_type") @db.VarChar(50)
  isInstant           Boolean              @default(false) @map("is_instant")
  requiresResponse    Boolean              @default(false) @map("requires_response")
  maxAmount           Decimal?             @map("max_amount") @db.Decimal(18, 2)
  minAmount           Decimal              @default(0) @map("min_amount") @db.Decimal(18, 2)
  feeStructure        Json                 @default("{}") @map("fee_structure")
  productConfig       Json                 @default("{}") @map("product_config")
  validationRules     Json                 @default("{}") @map("validation_rules")
  isActive            Boolean              @default(true) @map("is_active")
  metadata            Json                 @default("{}")
  createdAt           DateTime             @default(now()) @map("created_at")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  createdBy           String?              @map("created_by") @db.VarChar(100)
  updatedBy           String?              @map("updated_by") @db.VarChar(100)
  feeConfigurations   FeeConfiguration[]
  paymentRail         PaymentRail          @relation(fields: [railId], references: [id])
  paymentTransactions PaymentTransaction[]
  routingRules        RoutingRule[]
  validationRulesRel  ValidationRule[]
  workflowDefinitions WorkflowDefinition[]

  @@unique([railId, productCode])
  @@index([railId])
  @@index([productCode])
  @@map("payment_products")
}

model PaymentRailCountry {
  id                    String      @id @default(dbgenerated("uuid_generate_v4()")) @map("rail_country_id") @db.Uuid
  railId                String      @map("rail_id") @db.Uuid
  countryId             String      @map("country_id") @db.Uuid
  isDomestic            Boolean     @default(true) @map("is_domestic")
  isCrossBorder         Boolean     @default(false) @map("is_cross_border")
  isActive              Boolean     @default(true) @map("is_active")
  effectiveFrom         DateTime?   @map("effective_from") @db.Date
  effectiveTo           DateTime?   @map("effective_to") @db.Date
  countrySpecificConfig Json        @default("{}") @map("country_specific_config")
  metadata              Json        @default("{}")
  createdAt             DateTime    @default(now()) @map("created_at")
  updatedAt             DateTime    @updatedAt @map("updated_at")
  country               Country     @relation(fields: [countryId], references: [id])
  paymentRail           PaymentRail @relation(fields: [railId], references: [id])

  @@unique([railId, countryId])
  @@index([railId])
  @@index([countryId])
  @@map("payment_rail_countries")
}

model PaymentRailCurrency {
  id                     String      @id @default(dbgenerated("uuid_generate_v4()")) @map("rail_currency_id") @db.Uuid
  railId                 String      @map("rail_id") @db.Uuid
  currencyId             String      @map("currency_id") @db.Uuid
  isPrimary              Boolean     @default(false) @map("is_primary")
  isActive               Boolean     @default(true) @map("is_active")
  exchangeRateSource     String?     @map("exchange_rate_source") @db.VarChar(100)
  currencySpecificConfig Json        @default("{}") @map("currency_specific_config")
  metadata               Json        @default("{}")
  createdAt              DateTime    @default(now()) @map("created_at")
  updatedAt              DateTime    @updatedAt @map("updated_at")
  currency               Currency    @relation(fields: [currencyId], references: [id])
  paymentRail            PaymentRail @relation(fields: [railId], references: [id])

  @@unique([railId, currencyId])
  @@index([railId])
  @@map("payment_rail_currencies")
}

model WorkflowDefinition {
  id                      String                   @id @default(dbgenerated("uuid_generate_v4()")) @map("workflow_id") @db.Uuid
  railId                  String                   @map("rail_id") @db.Uuid
  productId               String?                  @map("product_id") @db.Uuid
  workflowCode            String                   @map("workflow_code") @db.VarChar(50)
  workflowName            String                   @map("workflow_name") @db.VarChar(100)
  workflowDescription     String?                  @map("workflow_description")
  workflowVersion         String                   @default("1.0") @map("workflow_version") @db.VarChar(20)
  direction               PaymentDirection
  isDefault               Boolean                  @default(false) @map("is_default")
  isActive                Boolean                  @default(true) @map("is_active")
  workflowConfig          Json                     @default("{}") @map("workflow_config")
  retryPolicy             Json                     @default("{\"max_retries\": 3, \"backoff_multiplier\": 2, \"exponential_backoff\": true, \"retry_delay_seconds\": 60}") @map("retry_policy")
  timeoutConfig           Json                     @default("{\"step_timeout_minutes\": 5, \"workflow_timeout_minutes\": 60}") @map("timeout_config")
  hitlConfig              Json                     @default("{\"enabled\": true, \"require_approval_for\": [\"SUSPICIOUS\", \"ERROR\", \"AMOUNT_THRESHOLD\"], \"auto_escalate_after_minutes\": 30}") @map("hitl_config")
  metadata                Json                     @default("{}")
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @updatedAt @map("updated_at")
  createdBy               String?                  @map("created_by") @db.VarChar(100)
  updatedBy               String?                  @map("updated_by") @db.VarChar(100)
  hitlInterventions       HitlIntervention[]
  paymentErrorLogs        PaymentErrorLog[]
  paymentProcessLogs      PaymentProcessLog[]
  paymentTransactions     PaymentTransaction[]
  paymentProduct          PaymentProduct?          @relation(fields: [productId], references: [id])
  paymentRail             PaymentRail              @relation(fields: [railId], references: [id])
  workflowStepTransitions WorkflowStepTransition[]
  workflowSteps           WorkflowStep[]

  @@unique([railId, productId, workflowCode, workflowVersion])
  @@index([railId])
  @@index([productId])
  @@index([workflowCode])
  @@map("workflow_definitions")
}

model WorkflowStep {
  id                          String                   @id @default(dbgenerated("uuid_generate_v4()")) @map("step_id") @db.Uuid
  workflowId                  String                   @map("workflow_id") @db.Uuid
  stepSequence                Int                      @map("step_sequence")
  stepCode                    String                   @map("step_code") @db.VarChar(50)
  stepName                    String                   @map("step_name") @db.VarChar(100)
  stepDescription             String?                  @map("step_description")
  stepType                    WorkflowStepType         @map("step_type")
  isMandatory                 Boolean                  @default(true) @map("is_mandatory")
  isAsync                     Boolean                  @default(false) @map("is_async")
  isHitlCheckpoint            Boolean                  @default(false) @map("is_hitl_checkpoint")
  conditionExpression         String?                  @map("condition_expression")
  skipOnCondition             Boolean                  @default(false) @map("skip_on_condition")
  onErrorAction               String                   @default("FAIL") @map("on_error_action") @db.VarChar(50)
  maxRetries                  Int                      @default(3) @map("max_retries")
  retryDelaySeconds           Int                      @default(60) @map("retry_delay_seconds")
  stepConfig                  Json                     @default("{}") @map("step_config")
  inputMapping                Json                     @default("{}") @map("input_mapping")
  outputMapping               Json                     @default("{}") @map("output_mapping")
  validationSchema            Json                     @default("{}") @map("validation_schema")
  hitlTriggers                Json                     @default("[]") @map("hitl_triggers")
  isActive                    Boolean                  @default(true) @map("is_active")
  metadata                    Json                     @default("{}")
  createdAt                   DateTime                 @default(now()) @map("created_at")
  updatedAt                   DateTime                 @updatedAt @map("updated_at")
  hitlInterventions           HitlIntervention[]
  paymentErrorLogs            PaymentErrorLog[]
  paymentProcessLogs          PaymentProcessLog[]
  paymentTransactions         PaymentTransaction[]
  workflowStepTransitionsFrom WorkflowStepTransition[] @relation("FromStep")
  workflowStepTransitionsTo   WorkflowStepTransition[] @relation("ToStep")
  workflowDefinition          WorkflowDefinition       @relation(fields: [workflowId], references: [id])

  @@unique([workflowId, stepSequence])
  @@unique([workflowId, stepCode])
  @@index([workflowId])
  @@index([stepType])
  @@map("workflow_steps")
}

model WorkflowStepTransition {
  id                  String              @id @default(dbgenerated("uuid_generate_v4()")) @map("transition_id") @db.Uuid
  workflowId          String              @map("workflow_id") @db.Uuid
  fromStepId          String?             @map("from_step_id") @db.Uuid
  toStepId            String?             @map("to_step_id") @db.Uuid
  transitionTrigger   StepExecutionStatus @map("transition_trigger")
  conditionExpression String?             @map("condition_expression")
  priority            Int                 @default(1)
  isActive            Boolean             @default(true) @map("is_active")
  metadata            Json                @default("{}")
  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")
  fromStep            WorkflowStep?       @relation("FromStep", fields: [fromStepId], references: [id])
  toStep              WorkflowStep?       @relation("ToStep", fields: [toStepId], references: [id])
  workflowDefinition  WorkflowDefinition  @relation(fields: [workflowId], references: [id])

  @@index([workflowId])
  @@index([fromStepId])
  @@map("workflow_step_transitions")
}

model ValidationRule {
  id              String          @id @default(dbgenerated("uuid_generate_v4()")) @map("rule_id") @db.Uuid
  railId          String?         @map("rail_id") @db.Uuid
  productId       String?         @map("product_id") @db.Uuid
  ruleCode        String          @map("rule_code") @db.VarChar(50)
  ruleName        String          @map("rule_name") @db.VarChar(100)
  ruleDescription String?         @map("rule_description")
  ruleCategory    String?         @map("rule_category") @db.VarChar(50)
  rulePriority    Int             @default(100) @map("rule_priority")
  ruleExpression  Json            @map("rule_expression")
  errorCode       String?         @map("error_code") @db.VarChar(50)
  errorMessage    String?         @map("error_message")
  isBlocking      Boolean         @default(true) @map("is_blocking")
  isActive        Boolean         @default(true) @map("is_active")
  effectiveFrom   DateTime?       @map("effective_from") @db.Date
  effectiveTo     DateTime?       @map("effective_to") @db.Date
  metadata        Json            @default("{}")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  createdBy       String?         @map("created_by") @db.VarChar(100)
  updatedBy       String?         @map("updated_by") @db.VarChar(100)
  paymentProduct  PaymentProduct? @relation(fields: [productId], references: [id])
  paymentRail     PaymentRail?    @relation(fields: [railId], references: [id])

  @@index([railId])
  @@index([productId])
  @@index([ruleCategory])
  @@map("validation_rules")
}

model RoutingRule {
  id                   String          @id @default(dbgenerated("uuid_generate_v4()")) @map("routing_rule_id") @db.Uuid
  ruleCode             String          @unique @map("rule_code") @db.VarChar(50)
  ruleName             String          @map("rule_name") @db.VarChar(100)
  ruleDescription      String?         @map("rule_description")
  rulePriority         Int             @default(100) @map("rule_priority")
  conditionCountryFrom String?         @map("condition_country_from") @db.Uuid
  conditionCountryTo   String?         @map("condition_country_to") @db.Uuid
  conditionCurrency    String?         @map("condition_currency") @db.Uuid
  conditionAmountMin   Decimal?        @map("condition_amount_min") @db.Decimal(18, 2)
  conditionAmountMax   Decimal?        @map("condition_amount_max") @db.Decimal(18, 2)
  conditionExpression  Json?           @map("condition_expression")
  targetRailId         String          @map("target_rail_id") @db.Uuid
  targetProductId      String?         @map("target_product_id") @db.Uuid
  fallbackRailId       String?         @map("fallback_rail_id") @db.Uuid
  isActive             Boolean         @default(true) @map("is_active")
  effectiveFrom        DateTime?       @map("effective_from") @db.Date
  effectiveTo          DateTime?       @map("effective_to") @db.Date
  metadata             Json            @default("{}")
  createdAt            DateTime        @default(now()) @map("created_at")
  updatedAt            DateTime        @updatedAt @map("updated_at")
  createdBy            String?         @map("created_by") @db.VarChar(100)
  updatedBy            String?         @map("updated_by") @db.VarChar(100)
  countryFrom          Country?        @relation("CountryFrom", fields: [conditionCountryFrom], references: [id])
  countryTo            Country?        @relation("CountryTo", fields: [conditionCountryTo], references: [id])
  currency             Currency?       @relation(fields: [conditionCurrency], references: [id])
  fallbackRail         PaymentRail?    @relation("FallbackRail", fields: [fallbackRailId], references: [id])
  targetProduct        PaymentProduct? @relation(fields: [targetProductId], references: [id])
  targetRail           PaymentRail     @relation("TargetRail", fields: [targetRailId], references: [id])

  @@index([rulePriority])
  @@index([targetRailId])
  @@map("routing_rules")
}

model PaymentTransaction {
  id                   String              @id @default(dbgenerated("uuid_generate_v4()")) @map("transaction_id") @db.Uuid
  transactionRef       String              @unique @map("transaction_ref") @db.VarChar(50)
  endToEndId           String?             @map("end_to_end_id") @db.VarChar(35)
  instructionId        String?             @map("instruction_id") @db.VarChar(35)
  uetr                 String?             @db.VarChar(36)
  railId               String              @map("rail_id") @db.Uuid
  productId            String?             @map("product_id") @db.Uuid
  workflowId           String?             @map("workflow_id") @db.Uuid
  direction            PaymentDirection
  status               TransactionStatus   @default(INITIATED)
  previousStatus       TransactionStatus?  @map("previous_status")
  instructedAmount     Decimal             @map("instructed_amount") @db.Decimal(18, 2)
  instructedCurrencyId String              @map("instructed_currency_id") @db.Uuid
  settlementAmount     Decimal?            @map("settlement_amount") @db.Decimal(18, 2)
  settlementCurrencyId String?             @map("settlement_currency_id") @db.Uuid
  exchangeRate         Decimal?            @map("exchange_rate") @db.Decimal(18, 8)
  chargesAmount        Decimal             @default(0) @map("charges_amount") @db.Decimal(18, 2)
  chargeBearer         String              @default("SLEV") @map("charge_bearer") @db.VarChar(20)
  creationDatetime     DateTime            @default(now()) @map("creation_datetime")
  valueDate            DateTime?           @map("value_date") @db.Date
  settlementDate       DateTime?           @map("settlement_date") @db.Date
  completedDatetime    DateTime?           @map("completed_datetime")
  purposeCode          String?             @map("purpose_code") @db.VarChar(10)
  purposeDescription   String?             @map("purpose_description") @db.VarChar(140)
  remittanceInfo       String?             @map("remittance_info")
  batchId              String?             @map("batch_id") @db.Uuid
  batchSequence        Int?                @map("batch_sequence")
  currentStepId        String?             @map("current_step_id") @db.Uuid
  retryCount           Int                 @default(0) @map("retry_count")
  isSuspicious         Boolean             @default(false) @map("is_suspicious")
  requiresHitl         Boolean             @default(false) @map("requires_hitl")
  railSpecificData     Json                @default("{}") @map("rail_specific_data")
  originalMessage      Json?               @map("original_message")
  transformedMessage   Json?               @map("transformed_message")
  responseMessage      Json?               @map("response_message")
  createdBy            String?             @map("created_by") @db.VarChar(100)
  updatedBy            String?             @map("updated_by") @db.VarChar(100)
  createdAt            DateTime            @default(now()) @map("created_at")
  updatedAt            DateTime            @updatedAt @map("updated_at")
  metadata             Json                @default("{}")
  hitlAuditTrails      HitlAuditTrail[]
  hitlInterventions    HitlIntervention[]
  paymentErrorLogs     PaymentErrorLog[]
  paymentProcessLogs   PaymentProcessLog[]
  currentStep          WorkflowStep?       @relation(fields: [currentStepId], references: [id])
  instructedCurrency   Currency            @relation("InstructedCurrency", fields: [instructedCurrencyId], references: [id])
  paymentProduct       PaymentProduct?     @relation(fields: [productId], references: [id])
  paymentRail          PaymentRail         @relation(fields: [railId], references: [id])
  settlementCurrency   Currency?           @relation("SettlementCurrency", fields: [settlementCurrencyId], references: [id])
  workflowDefinition   WorkflowDefinition? @relation(fields: [workflowId], references: [id])
  transactionParties   TransactionParty[]

  @@index([transactionRef])
  @@index([endToEndId])
  @@index([uetr])
  @@index([railId])
  @@index([productId])
  @@index([status])
  @@index([direction])
  @@index([creationDatetime])
  @@index([valueDate])
  @@index([isSuspicious])
  @@index([requiresHitl])
  @@map("payment_transactions")
}

model TransactionParty {
  id                 String             @id @default(dbgenerated("uuid_generate_v4()")) @map("party_id") @db.Uuid
  transactionId      String             @map("transaction_id") @db.Uuid
  partyType          PartyType          @map("party_type")
  partySequence      Int                @default(1) @map("party_sequence")
  partyName          String?            @map("party_name") @db.VarChar(140)
  partyAccountNumber String?            @map("party_account_number") @db.VarChar(50)
  partyAccountType   String?            @map("party_account_type") @db.VarChar(20)
  partyBic           String?            @map("party_bic") @db.VarChar(11)
  partyLei           String?            @map("party_lei") @db.VarChar(20)
  partyRoutingNumber String?            @map("party_routing_number") @db.VarChar(20)
  addressLine1       String?            @map("address_line1") @db.VarChar(100)
  addressLine2       String?            @map("address_line2") @db.VarChar(100)
  city               String?            @db.VarChar(50)
  stateProvince      String?            @map("state_province") @db.VarChar(50)
  postalCode         String?            @map("postal_code") @db.VarChar(20)
  countryId          String?            @map("country_id") @db.Uuid
  agentName          String?            @map("agent_name") @db.VarChar(140)
  agentBic           String?            @map("agent_bic") @db.VarChar(11)
  agentRoutingNumber String?            @map("agent_routing_number") @db.VarChar(20)
  agentAccount       String?            @map("agent_account") @db.VarChar(50)
  partyDetails       Json               @default("{}") @map("party_details")
  metadata           Json               @default("{}")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")
  country            Country?           @relation(fields: [countryId], references: [id])
  paymentTransaction PaymentTransaction @relation(fields: [transactionId], references: [id])

  @@index([transactionId])
  @@index([partyType])
  @@index([partyAccountNumber])
  @@index([partyBic])
  @@map("transaction_parties")
}

model PaymentProcessLog {
  id                 String               @id @default(dbgenerated("uuid_generate_v4()")) @map("log_id") @db.Uuid
  transactionId      String               @map("transaction_id") @db.Uuid
  workflowId         String?              @map("workflow_id") @db.Uuid
  stepId             String?              @map("step_id") @db.Uuid
  eventId            String               @map("event_id") @db.VarChar(50)
  eventSequence      BigInt               @map("event_sequence")
  eventType          String               @map("event_type") @db.VarChar(50)
  eventTimestamp     DateTime             @default(now()) @map("event_timestamp")
  executionStatus    StepExecutionStatus  @map("execution_status")
  previousStatus     StepExecutionStatus? @map("previous_status")
  transactionStatus  TransactionStatus?   @map("transaction_status")
  stepCode           String?              @map("step_code") @db.VarChar(50)
  stepName           String?              @map("step_name") @db.VarChar(100)
  durationMs         BigInt?              @map("duration_ms")
  inputData          Json?                @map("input_data")
  outputData         Json?                @map("output_data")
  executionContext   HitlContext?         @map("execution_context")
  isHitlTriggered    Boolean              @default(false) @map("is_hitl_triggered")
  hitlReason         String?              @map("hitl_reason")
  retryAttempt       Int                  @default(0) @map("retry_attempt")
  isRetry            Boolean              @default(false) @map("is_retry")
  parentLogId        String?              @map("parent_log_id") @db.Uuid
  correlationId      String?              @map("correlation_id") @db.VarChar(50)
  traceId            String?              @map("trace_id") @db.VarChar(50)
  spanId             String?              @map("span_id") @db.VarChar(50)
  processorId        String?              @map("processor_id") @db.VarChar(100)
  processorHost      String?              @map("processor_host") @db.VarChar(100)
  message            String?
  details            Json                 @default("{}")
  metadata           Json                 @default("{}")
  createdAt          DateTime             @default(now()) @map("created_at")
  hitlInterventions  HitlIntervention[]
  paymentErrorLogs   PaymentErrorLog[]
  parentLog          PaymentProcessLog?   @relation("ProcessLogRetry", fields: [parentLogId], references: [id])
  retryLogs          PaymentProcessLog[]  @relation("ProcessLogRetry")
  workflowStep       WorkflowStep?        @relation(fields: [stepId], references: [id])
  paymentTransaction PaymentTransaction   @relation(fields: [transactionId], references: [id])
  workflowDefinition WorkflowDefinition?  @relation(fields: [workflowId], references: [id])

  @@index([transactionId])
  @@index([workflowId])
  @@index([stepId])
  @@index([eventType])
  @@index([executionStatus])
  @@index([eventTimestamp])
  @@index([transactionId, eventSequence])
  @@index([isHitlTriggered])
  @@index([correlationId])
  @@index([traceId])
  @@map("payment_process_logs")
}

model PaymentErrorLog {
  id                 String              @id @default(dbgenerated("uuid_generate_v4()")) @map("error_log_id") @db.Uuid
  transactionId      String?             @map("transaction_id") @db.Uuid
  processLogId       String?             @map("process_log_id") @db.Uuid
  workflowId         String?             @map("workflow_id") @db.Uuid
  stepId             String?             @map("step_id") @db.Uuid
  errorId            String              @map("error_id") @db.VarChar(50)
  errorCode          String              @map("error_code") @db.VarChar(50)
  errorCategory      String?             @map("error_category") @db.VarChar(50)
  errorSeverity      ErrorSeverity       @default(ERROR) @map("error_severity")
  errorMessage       String              @map("error_message")
  errorDescription   String?             @map("error_description")
  stackTrace         String?             @map("stack_trace")
  rootCauseCode      String?             @map("root_cause_code") @db.VarChar(50)
  rootCauseMessage   String?             @map("root_cause_message")
  sourceSystem       String?             @map("source_system") @db.VarChar(100)
  sourceComponent    String?             @map("source_component") @db.VarChar(100)
  isResolved         Boolean             @default(false) @map("is_resolved")
  resolvedAt         DateTime?           @map("resolved_at")
  resolvedBy         String?             @map("resolved_by") @db.VarChar(100)
  resolutionNotes    String?             @map("resolution_notes")
  resolutionAction   String?             @map("resolution_action") @db.VarChar(50)
  requiresHitl       Boolean             @default(false) @map("requires_hitl")
  hitlContext        HitlContext?        @map("hitl_context")
  requestPayload     Json?               @map("request_payload")
  responsePayload    Json?               @map("response_payload")
  errorDetails       Json                @default("{}") @map("error_details")
  metadata           Json                @default("{}")
  createdAt          DateTime            @default(now()) @map("created_at")
  hitlInterventions  HitlIntervention[]
  paymentProcessLog  PaymentProcessLog?  @relation(fields: [processLogId], references: [id])
  workflowStep       WorkflowStep?       @relation(fields: [stepId], references: [id])
  paymentTransaction PaymentTransaction? @relation(fields: [transactionId], references: [id])
  workflowDefinition WorkflowDefinition? @relation(fields: [workflowId], references: [id])

  @@index([transactionId])
  @@index([processLogId])
  @@index([errorCode])
  @@index([errorCategory])
  @@index([errorSeverity])
  @@index([isResolved])
  @@index([createdAt])
  @@map("payment_error_logs")
}

model HitlIntervention {
  id                  String               @id @default(dbgenerated("uuid_generate_v4()")) @map("intervention_id") @db.Uuid
  transactionId       String               @map("transaction_id") @db.Uuid
  processLogId        String?              @map("process_log_id") @db.Uuid
  errorLogId          String?              @map("error_log_id") @db.Uuid
  workflowId          String?              @map("workflow_id") @db.Uuid
  stepId              String?              @map("step_id") @db.Uuid
  queueName           String               @default("DEFAULT") @map("queue_name") @db.VarChar(50)
  priority            Int                  @default(5)
  interventionContext HitlContext          @map("intervention_context")
  triggerReason       String               @map("trigger_reason")
  transactionStatus   TransactionStatus?   @map("transaction_status")
  stepStatus          StepExecutionStatus? @map("step_status")
  assignedTo          String?              @map("assigned_to") @db.VarChar(100)
  assignedAt          DateTime?            @map("assigned_at")
  assignedBy          String?              @map("assigned_by") @db.VarChar(100)
  createdAt           DateTime             @default(now()) @map("created_at")
  dueAt               DateTime?            @map("due_at")
  escalationAt        DateTime?            @map("escalation_at")
  isEscalated         Boolean              @default(false) @map("is_escalated")
  escalatedTo         String?              @map("escalated_to") @db.VarChar(100)
  actionTaken         HitlActionType?      @map("action_taken")
  actionNotes         String?              @map("action_notes")
  resolvedAt          DateTime?            @map("resolved_at")
  resolvedBy          String?              @map("resolved_by") @db.VarChar(100)
  reviewData          Json                 @default("{}") @map("review_data")
  modificationData    Json?                @map("modification_data")
  isActive            Boolean              @default(true) @map("is_active")
  isResolved          Boolean              @default(false) @map("is_resolved")
  metadata            Json                 @default("{}")
  updatedAt           DateTime             @updatedAt @map("updated_at")
  hitlAuditTrails     HitlAuditTrail[]
  paymentErrorLog     PaymentErrorLog?     @relation(fields: [errorLogId], references: [id])
  paymentProcessLog   PaymentProcessLog?   @relation(fields: [processLogId], references: [id])
  workflowStep        WorkflowStep?        @relation(fields: [stepId], references: [id])
  paymentTransaction  PaymentTransaction   @relation(fields: [transactionId], references: [id])
  workflowDefinition  WorkflowDefinition?  @relation(fields: [workflowId], references: [id])

  @@index([transactionId])
  @@index([queueName])
  @@index([priority])
  @@index([interventionContext])
  @@index([assignedTo])
  @@index([isActive])
  @@index([dueAt])
  @@index([isEscalated])
  @@map("hitl_interventions")
}

model HitlAuditTrail {
  id                 String             @id @default(dbgenerated("uuid_generate_v4()")) @map("audit_id") @db.Uuid
  interventionId     String             @map("intervention_id") @db.Uuid
  transactionId      String             @map("transaction_id") @db.Uuid
  actionType         HitlActionType     @map("action_type")
  actionBy           String             @map("action_by") @db.VarChar(100)
  actionAt           DateTime           @default(now()) @map("action_at")
  previousState      Json?              @map("previous_state")
  newState           Json?              @map("new_state")
  actionReason       String?            @map("action_reason")
  actionNotes        String?            @map("action_notes")
  ipAddress          String?            @map("ip_address")
  userAgent          String?            @map("user_agent")
  metadata           Json               @default("{}")
  hitlIntervention   HitlIntervention   @relation(fields: [interventionId], references: [id])
  paymentTransaction PaymentTransaction @relation(fields: [transactionId], references: [id])

  @@index([interventionId])
  @@index([transactionId])
  @@index([actionType])
  @@index([actionBy])
  @@index([actionAt])
  @@map("hitl_audit_trail")
}

model SystemConfiguration {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @map("config_id") @db.Uuid
  configKey     String    @unique @map("config_key") @db.VarChar(100)
  configValue   String    @map("config_value")
  configType    String    @default("STRING") @map("config_type") @db.VarChar(20)
  category      String?   @db.VarChar(50)
  description   String?
  isSensitive   Boolean   @default(false) @map("is_sensitive")
  isActive      Boolean   @default(true) @map("is_active")
  effectiveFrom DateTime? @map("effective_from")
  effectiveTo   DateTime? @map("effective_to")
  metadata      Json      @default("{}")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  createdBy     String?   @map("created_by") @db.VarChar(100)
  updatedBy     String?   @map("updated_by") @db.VarChar(100)

  @@index([configKey])
  @@index([category])
  @@map("system_configuration")
}

model FeeConfiguration {
  id             String          @id @default(dbgenerated("uuid_generate_v4()")) @map("fee_id") @db.Uuid
  railId         String          @map("rail_id") @db.Uuid
  productId      String?         @map("product_id") @db.Uuid
  feeCode        String          @map("fee_code") @db.VarChar(50)
  feeName        String          @map("fee_name") @db.VarChar(100)
  feeType        String          @map("fee_type") @db.VarChar(20)
  feeAmount      Decimal?        @map("fee_amount") @db.Decimal(18, 4)
  feePercentage  Decimal?        @map("fee_percentage") @db.Decimal(8, 6)
  minFee         Decimal?        @map("min_fee") @db.Decimal(18, 2)
  maxFee         Decimal?        @map("max_fee") @db.Decimal(18, 2)
  currencyId     String?         @map("currency_id") @db.Uuid
  amountFrom     Decimal?        @map("amount_from") @db.Decimal(18, 2)
  amountTo       Decimal?        @map("amount_to") @db.Decimal(18, 2)
  tierConfig     Json?           @map("tier_config")
  isActive       Boolean         @default(true) @map("is_active")
  effectiveFrom  DateTime?       @map("effective_from") @db.Date
  effectiveTo    DateTime?       @map("effective_to") @db.Date
  metadata       Json            @default("{}")
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")
  currency       Currency?       @relation(fields: [currencyId], references: [id])
  paymentProduct PaymentProduct? @relation(fields: [productId], references: [id])
  paymentRail    PaymentRail     @relation(fields: [railId], references: [id])

  @@index([railId])
  @@index([productId])
  @@map("fee_configuration")
}

model AuditTrail {
  id            String   @id @default(dbgenerated("uuid_generate_v4()")) @map("audit_id") @db.Uuid
  tableName     String   @map("table_name") @db.VarChar(100)
  recordId      String   @map("record_id") @db.Uuid
  action        String   @db.VarChar(20)
  oldValues     Json?    @map("old_values")
  newValues     Json?    @map("new_values")
  changedFields String[] @map("changed_fields")
  changedBy     String?  @map("changed_by") @db.VarChar(100)
  changedAt     DateTime @default(now()) @map("changed_at")
  ipAddress     String?  @map("ip_address")
  userAgent     String?  @map("user_agent")
  correlationId String?  @map("correlation_id") @db.VarChar(50)
  metadata      Json     @default("{}")

  @@index([tableName])
  @@index([recordId])
  @@index([action])
  @@index([changedAt])
  @@index([changedBy])
  @@map("audit_trail")
}

enum TransactionStatus {
  INITIATED
  VALIDATED
  PENDING_APPROVAL
  APPROVED
  REJECTED
  PROCESSING
  SENT_TO_RAIL
  ACKNOWLEDGED
  SETTLED
  COMPLETED
  FAILED
  CANCELLED
  RETURNED
  SUSPICIOUS
  ON_HOLD
  PENDING_REVIEW
}

enum StepExecutionStatus {
  PENDING
  IN_PROGRESS
  SUCCESS
  FAILURE
  ERROR
  SUSPICIOUS
  SKIPPED
  TIMEOUT
  WAITING_HITL
  HITL_APPROVED
  HITL_REJECTED
  RETRYING
}

enum HitlActionType {
  APPROVE
  REJECT
  RETRY
  RESTART
  SKIP
  ESCALATE
  MODIFY
  CANCEL
  FORCE_COMPLETE
}

enum HitlContext {
  SUCCESS
  FAILURE
  SUSPICIOUS
  ERROR
  TIMEOUT
  COMPLIANCE_REVIEW
  AMOUNT_THRESHOLD
  FRAUD_ALERT
}

enum PaymentDirection {
  INBOUND
  OUTBOUND
  INTERNAL
}

enum PartyType {
  DEBTOR
  CREDITOR
  ORIGINATOR
  BENEFICIARY
  INTERMEDIARY
  CORRESPONDENT
}

enum ErrorSeverity {
  INFO
  WARNING
  ERROR
  CRITICAL
  FATAL
}

enum WorkflowStepType {
  VALIDATION
  TRANSFORMATION
  ENRICHMENT
  ROUTING
  COMPLIANCE_CHECK
  FRAUD_CHECK
  AUTHORIZATION
  SUBMISSION
  ACKNOWLEDGMENT
  SETTLEMENT
  NOTIFICATION
  RECONCILIATION
  HITL_CHECKPOINT
}
